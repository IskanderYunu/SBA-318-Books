<!-- views/index.ejs -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Tracker</title>
  </head>
  <body>
    <h1>Book Tracker</h1>

    <h2>Books List</h2>
    <ul>
      <% books.forEach(function(book) { %>
      <li>
        <strong><%= book.title %></strong> by <%= book.author %> (Year: <%=
        book.year %>) - <a href="/books/<%= book.id %>">View Details</a>
      </li>
      <% }) %>
    </ul>

    <h2>Add a New Book</h2>
    <form action="/books" method="POST">
      <label for="title">Title: </label>
      <input type="text" name="title" required /><br />
      <label for="author">Author: </label>
      <input type="text" name="author" required /><br />
      <label for="year">Year: </label>
      <input type="number" name="year" required /><br />
      <button type="submit">Add Book</button>
    </form>

    <script>
      // Form submission using fetch
      document
        .getElementById("addBookForm")
        .addEventListener("submit", function (e) {
          e.preventDefault(); // Stops form from reloading page

          const title = document.getElementById("title").value;
          const author = document.getElementById("author").value;
          const year = document.getElementById("year").value;

          // Send a POST request to the API to add a new book
          fetch("/books", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ title, author, year }),
          })
            .then((response) => response.json())
            .then((data) => {
              // Add the new book to the list w/o reload page
              const bookList = document.getElementById("bookList");
              const newBookItem = document.createElement("li");
              newBookItem.innerHTML = `<strong>${data.title}</strong> by ${data.author} (Year: ${data.year})`;
              bookList.appendChild(newBookItem);

              // Clear the form fields
              document.getElementById("title").value = "";
              document.getElementById("author").value = "";
              document.getElementById("year").value = "";
            })
            .catch((error) => console.error("Error adding book:", error));
        });
    </script>
  </body>
</html>
